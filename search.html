---
layout: default
title: Search
permalink: /search/
---

<div class="search-page">
  <header class="page-header">
    <h1 class="page-title">Search</h1>
    <p class="page-description">Search for content on Coffee Prism</p>
  </header>

  <div class="search-container">
    <form id="search-form" action="javascript:void(0);">
      <div class="search-input-container">
        <input type="text" id="search-input" placeholder="Enter keywords..." class="search-input">
        <button type="submit" class="search-button">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </form>
  </div>

  <div id="search-results" class="search-results">
    <p class="search-message">Enter keywords to start searching</p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Load search index
    var searchIndex = [];
    var searchData = [];

    // Load article data
    {% for post in site.posts %}
      searchData.push({
        title: "{{ post.title | escape }}",
        content: {{ post.content | strip_html | jsonify }},
        url: "{{ post.url | relative_url }}",
        date: "{{ post.date | date: '%Y-%m-%d' }}",
        type: "Article",
        categories: [{% for category in post.categories %}"{{ category }}"{% unless forloop.last %},{% endunless %}{% endfor %}],
        tags: [{% for tag in post.tags %}"{{ tag }}"{% unless forloop.last %},{% endunless %}{% endfor %}]
      });
    {% endfor %}

    // Load coffee data
    {% for coffee in site.coffee %}
      searchData.push({
        title: "{{ coffee.title | escape }}",
        content: {{ coffee.content | strip_html | jsonify }},
        url: "{{ coffee.url | relative_url }}",
        date: "",
        type: "Coffee",
        categories: [],
        tags: [{% for tag in coffee.tags %}"{{ tag }}"{% unless forloop.last %},{% endunless %}{% endfor %}]
      });
    {% endfor %}

    // Load equipment data
    {% for equipment in site.equipment %}
      searchData.push({
        title: "{{ equipment.title | escape }}",
        content: {{ equipment.content | strip_html | jsonify }},
        url: "{{ equipment.url | relative_url }}",
        date: "",
        type: "Equipment",
        categories: [],
        tags: [{% for tag in equipment.tags %}"{{ tag }}"{% unless forloop.last %},{% endunless %}{% endfor %}]
      });
    {% endfor %}

    // Simple search function
    function search(query) {
      query = query.toLowerCase();
      return searchData.filter(function(item) {
        return item.title.toLowerCase().includes(query) || 
               item.content.toLowerCase().includes(query) ||
               item.tags.some(function(tag) { return tag.toLowerCase().includes(query); }) ||
               item.categories.some(function(category) { return category.toLowerCase().includes(query); });
      });
    }

    // Handle search form submission
    document.getElementById('search-form').addEventListener('submit', function(e) {
      e.preventDefault();
      var query = document.getElementById('search-input').value.trim();
      if (query.length < 2) {
        document.getElementById('search-results').innerHTML = '<p class="search-message">Please enter at least 2 characters</p>';
        return;
      }

      var results = search(query);
      displayResults(results, query);
    });

    // Display search results
    function displayResults(results, query) {
      var resultsContainer = document.getElementById('search-results');
      
      if (results.length === 0) {
        resultsContainer.innerHTML = '<p class="search-message">No results found for "' + query + '"</p>';
        return;
      }

      var html = '<h2>Search Results (' + results.length + ')</h2><ul class="search-results-list">';
      
      results.forEach(function(item) {
        html += '<li class="search-result-item">';
        html += '<a href="' + item.url + '" class="search-result-link">';
        html += '<h3>' + item.title + '</h3>';
        html += '<div class="search-result-meta">';
        html += '<span class="search-result-type">' + item.type + '</span>';
        if (item.date) {
          html += '<span class="search-result-date">' + item.date + '</span>';
        }
        html += '</div>';
        
        // Extract content snippet containing the query
        var contentPreview = getContentPreview(item.content, query, 200);
        html += '<p class="search-result-preview">' + contentPreview + '</p>';
        
        if (item.tags.length > 0) {
          html += '<div class="search-result-tags">';
          item.tags.forEach(function(tag) {
            html += '<span class="search-result-tag">' + tag + '</span>';
          });
          html += '</div>';
        }
        
        html += '</a></li>';
      });
      
      html += '</ul>';
      resultsContainer.innerHTML = html;
    }

    // Get content preview, try to find snippet containing the query
    function getContentPreview(content, query, maxLength) {
      var lowerContent = content.toLowerCase();
      var queryIndex = lowerContent.indexOf(query.toLowerCase());
      
      if (queryIndex === -1) {
        // If query not found, return beginning of content
        return content.substring(0, maxLength) + '...';
      }
      
      // Calculate preview start and end positions
      var start = Math.max(0, queryIndex - 100);
      var end = Math.min(content.length, queryIndex + query.length + 100);
      
      // Adjust to avoid cutting words
      while (start > 0 && content[start] !== ' ' && content[start] !== '.') {
        start--;
      }
      
      while (end < content.length && content[end] !== ' ' && content[end] !== '.') {
        end++;
      }
      
      var preview = content.substring(start, end);
      
      // Add ellipses
      if (start > 0) {
        preview = '...' + preview;
      }
      
      if (end < content.length) {
        preview = preview + '...';
      }
      
      // Highlight query terms
      var regex = new RegExp('(' + query + ')', 'gi');
      preview = preview.replace(regex, '<strong>$1</strong>');
      
      return preview;
    }
  });
</script>

<style>
  .search-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }
  
  .search-input-container {
    display: flex;
    margin-bottom: 2rem;
  }
  
  .search-input {
    flex: 1;
    padding: 1rem;
    font-size: 1.1rem;
    border: 2px solid var(--border-color);
    border-right: none;
    border-radius: 4px 0 0 4px;
  }
  
  .search-button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 0 1.5rem;
    font-size: 1.1rem;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
  }
  
  .search-message {
    text-align: center;
    padding: 2rem;
    color: var(--text-color-light);
  }
  
  .search-results-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .search-result-item {
    margin-bottom: 2rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 1.5rem;
  }
  
  .search-result-item:last-child {
    border-bottom: none;
  }
  
  .search-result-link {
    display: block;
    color: var(--text-color);
    text-decoration: none;
  }
  
  .search-result-link:hover h3 {
    color: var(--primary-color);
  }
  
  .search-result-link h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
    transition: color 0.2s;
  }
  
  .search-result-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-color-light);
  }
  
  .search-result-preview {
    margin-bottom: 0.5rem;
    line-height: 1.5;
  }
  
  .search-result-preview strong {
    background-color: rgba(255, 204, 0, 0.3);
    padding: 0 2px;
  }
  
  .search-result-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .search-result-tag {
    background-color: var(--light-bg-color);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
  }
</style> 