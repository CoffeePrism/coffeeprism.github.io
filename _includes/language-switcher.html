{% assign page_language = page.lang | default: site.default_lang %}
{% assign translations = site.data.translations[page.namespace] %}

<div class="language-switcher">
  {% for lang in site.languages %}
    {% if lang == page_language %}
      <span class="active-lang">{{ site.data.i18n[lang].language_name }}</span>
    {% else %}
      {% if translations and translations[lang] %}
        <a href="{{ translations[lang].url | relative_url }}" class="lang-link">{{ site.data.i18n[lang].language_name }}</a>
      {% else %}
        {% if lang == 'en' %}
          {% assign fallback_url = page.url | replace_first: '/zh/', '/en/' %}
        {% else %}
          {% assign fallback_url = page.url | replace_first: '/en/', '/zh/' %}
        {% endif %}
        
        {% if page.url contains '/en/' or page.url contains '/zh/' %}
          <a href="{{ fallback_url }}" class="lang-link">{{ site.data.i18n[lang].language_name }}</a>
        {% else %}
          {% if lang == 'en' %}
            <a href="/en{{ page.url }}" class="lang-link">{{ site.data.i18n[lang].language_name }}</a>
          {% else %}
            <a href="{{ page.url }}" class="lang-link">{{ site.data.i18n[lang].language_name }}</a>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endif %}
  {% endfor %}
</div>

<style>
.language-switcher {
  display: inline-flex;
  align-items: center;
  gap: 1rem;
  padding: 0.5rem;
  border-radius: 4px;
  background: rgba(0, 0, 0, 0.05);
}

.language-switcher .active-lang {
  font-weight: bold;
  color: var(--primary-color, #007bff);
}

.language-switcher .lang-link {
  color: #666;
  text-decoration: none;
  transition: color 0.2s;
}

.language-switcher .lang-link:hover {
  color: var(--primary-color, #007bff);
  text-decoration: underline;
}

@media (max-width: 768px) {
  .language-switcher {
    margin: 1rem 0;
    justify-content: center;
  }
}
</style> 